

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Exercise 3: Using ONOS as the control plane &mdash; Software-Defined Networks: A Systems Approach Version 0.3-dev documentation</title>
  

  
  
    <link rel="shortcut icon" href="../static/bridge.ico"/>
  
  
  

  
  <script type="text/javascript" src="../static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
        <script type="text/javascript" src="../static/jquery.js"></script>
        <script type="text/javascript" src="../static/underscore.js"></script>
        <script type="text/javascript" src="../static/doctools.js"></script>
        <script type="text/javascript" src="../static/language_data.js"></script>
    
    <script type="text/javascript" src="../static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../static/css/rtd_theme_mods.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Exercise 4: Enabling ONOS built-in services" href="EXERCISE-4.html" />
    <link rel="prev" title="Exercise 2: Yang, OpenConfig, and gNMI basics" href="EXERCISE-2.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Software-Defined Networks: A Systems Approach
          

          
          </a>

          
            
            
              <div class="version">
                Version 0.3-dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Chapter 1:  Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../uses.html">Chapter 2:  Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">Chapter 3:  Basic Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../switch.html">Chapter 4:  White-Box Switches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stratum.html">Chapter 5:  Switch OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onos.html">Chapter 6:  Network OS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trellis.html">Chapter 7:  Leaf-Spine Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../future.html">Chapter 8:  Future of SDN</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../exercises.html">Programming Exercises</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="EXERCISE-1.html">Exercise 1: P4Runtime basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="EXERCISE-2.html">Exercise 2: Yang, OpenConfig, and gNMI basics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Exercise 3: Using ONOS as the control plane</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-onos">1. Start ONOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-app-and-register-pipeconf">2. Build app and register pipeconf</a></li>
<li class="toctree-l3"><a class="reference internal" href="#push-netcfg-to-onos">3. Push netcfg to ONOS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-the-onos-cli-to-verify-the-network-configuration">4. Use the ONOS CLI to verify the network configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#devices">Devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ports">Ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flow-rules-and-groups">Flow rules and groups</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#visualize-the-topology-on-the-onos-web-ui">5. Visualize the topology on the ONOS web UI</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pipeconf-ui">Pipeconf UI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#congratulations">Congratulations!</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bonus-inspect-stratum-bmv2-internal-state">Bonus: inspect stratum_bmv2 internal state</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bonus-show-onos-grpc-log">Bonus: show ONOS gRPC log</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="EXERCISE-4.html">Exercise 4: Enabling ONOS built-in services</a></li>
<li class="toctree-l2"><a class="reference internal" href="EXERCISE-5.html">Exercise 5: IPv6 routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="EXERCISE-6.html">Exercise 6: Segment Routing v6 (SRv6)</a></li>
<li class="toctree-l2"><a class="reference internal" href="EXERCISE-7.html">Exercise 7: Trellis Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="EXERCISE-8.html">Exercise 8: GTP termination with fabric.p4</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../README.html">About This Book</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Software-Defined Networks: A Systems Approach</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../exercises.html">Programming Exercises</a> &raquo;</li>
        
      <li>Exercise 3: Using ONOS as the control plane</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/exercises/EXERCISE-3.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="EXERCISE-4.html" class="btn btn-neutral float-right" title="Exercise 4: Enabling ONOS built-in services" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="EXERCISE-2.html" class="btn btn-neutral float-left" title="Exercise 2: Yang, OpenConfig, and gNMI basics" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="exercise-3-using-onos-as-the-control-plane">
<h1>Exercise 3: Using ONOS as the control plane<a class="headerlink" href="#exercise-3-using-onos-as-the-control-plane" title="Permalink to this headline">¶</a></h1>
<p>This exercise provides a hands-on introduction to ONOS where you will learn how
to:</p>
<ol class="simple">
<li>Start ONOS along with a set of built-in apps for basic services such as
topology discovery</li>
<li>Load a custom ONOS app and pipeconf</li>
<li>Push a configuration file to ONOS to discover and control the
<code class="docutils literal notranslate"><span class="pre">stratum_bmv2</span></code> switches using P4Runtime and gNMI</li>
<li>Access the ONOS CLI and UI to verify that all <code class="docutils literal notranslate"><span class="pre">stratum_bmv2</span></code> switches have
been discovered and configured correctly.</li>
</ol>
<div class="section" id="start-onos">
<h2>1. Start ONOS<a class="headerlink" href="#start-onos" title="Permalink to this headline">¶</a></h2>
<p>In a terminal window, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make restart
</pre></div>
</div>
<p>This command will restart the ONOS and Mininet containers, in case those were
running from previous exercises, clearing any previous state.</p>
<p>The parameters to start the ONOS container are specified in <a class="reference external" href="docker-compose.yml">docker
-compose.yml</a>. The container is configured to pass the
environment variable <code class="docutils literal notranslate"><span class="pre">ONOS_APPS</span></code>, used to define the built-in apps to load
during startup.</p>
<p>In our case this variable has value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ONOS_APPS</span><span class="o">=</span><span class="n">gui2</span><span class="p">,</span><span class="n">drivers</span><span class="o">.</span><span class="n">bmv2</span><span class="p">,</span><span class="n">lldpprovider</span><span class="p">,</span><span class="n">hostprovider</span>
</pre></div>
</div>
<p>Requesting ONOS to pre-load the following built-in apps:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">gui2</span></code>: ONOS web user interface (available at <a class="reference external" href="http://localhost:8181/onos/ui">http://localhost:8181/onos/ui</a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">drivers.bmv2</span></code>: BMv2/Stratum drivers based on P4Runtime, gNMI, and gNOI</li>
<li><code class="docutils literal notranslate"><span class="pre">lldpprovider</span></code>: LLDP-based link discovery application (used in Exercise 4)</li>
<li><code class="docutils literal notranslate"><span class="pre">hostprovider</span></code>: Host discovery application (used in Exercise 4)</li>
</ul>
<p>Once ONOS has started, you can check its log using the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">onos-log</span></code> command.</p>
<p>To <strong>verify that all required apps have been activated</strong>, run the following
command in a new terminal window to access the ONOS CLI. Use password <code class="docutils literal notranslate"><span class="pre">rocks</span></code>
when prompted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make onos-cli
</pre></div>
</div>
<p>If you see the following error, then ONOS is still starting; wait a minute and try again.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh_exchange_identification</span><span class="p">:</span> <span class="n">Connection</span> <span class="n">closed</span> <span class="n">by</span> <span class="n">remote</span> <span class="n">host</span>
<span class="n">make</span><span class="p">:</span> <span class="o">***</span> <span class="p">[</span><span class="n">onos</span><span class="o">-</span><span class="n">cli</span><span class="p">]</span> <span class="n">Error</span> <span class="mi">255</span>
</pre></div>
</div>
<p>When you see the Password prompt, type the default password: <code class="docutils literal notranslate"><span class="pre">rocks</span></code></p>
<p>Type the following command in the ONOS CLI to show the list of running apps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">apps</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<p>Make sure you see the following list of apps displayed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span>   <span class="mi">5</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">grpc</span>        <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">gRPC</span> <span class="n">Protocol</span> <span class="n">Subsystem</span>
<span class="o">*</span>   <span class="mi">6</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">gnmi</span>        <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">gNMI</span> <span class="n">Protocol</span> <span class="n">Subsystem</span>
<span class="o">*</span>  <span class="mi">29</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">drivers</span>               <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">Default</span> <span class="n">Drivers</span>
<span class="o">*</span>  <span class="mi">34</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">generaldeviceprovider</span> <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">General</span> <span class="n">Device</span> <span class="n">Provider</span>
<span class="o">*</span>  <span class="mi">35</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">p4runtime</span>   <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">P4Runtime</span> <span class="n">Protocol</span> <span class="n">Subsystem</span>
<span class="o">*</span>  <span class="mi">36</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">p4runtime</span>             <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">P4Runtime</span> <span class="n">Provider</span>
<span class="o">*</span>  <span class="mi">37</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">p4runtime</span>     <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">P4Runtime</span> <span class="n">Drivers</span>
<span class="o">*</span>  <span class="mi">42</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">gnoi</span>        <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">gNOI</span> <span class="n">Protocol</span> <span class="n">Subsystem</span>
<span class="o">*</span>  <span class="mi">52</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">hostprovider</span>          <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">Host</span> <span class="n">Location</span> <span class="n">Provider</span>
<span class="o">*</span>  <span class="mi">53</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">lldpprovider</span>          <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">LLDP</span> <span class="n">Link</span> <span class="n">Provider</span>
<span class="o">*</span>  <span class="mi">66</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">gnoi</span>          <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">gNOI</span> <span class="n">Drivers</span>
<span class="o">*</span>  <span class="mi">70</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">gnmi</span>          <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">gNMI</span> <span class="n">Drivers</span>
<span class="o">*</span>  <span class="mi">71</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">pipelines</span><span class="o">.</span><span class="n">basic</span>       <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">Basic</span> <span class="n">Pipelines</span>
<span class="o">*</span>  <span class="mi">72</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">stratum</span>       <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">Stratum</span> <span class="n">Drivers</span>
<span class="o">*</span> <span class="mi">161</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">gui2</span>                  <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">ONOS</span> <span class="n">GUI2</span>
<span class="o">*</span> <span class="mi">181</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">drivers</span><span class="o">.</span><span class="n">bmv2</span>          <span class="mf">2.2</span><span class="o">.</span><span class="mi">2</span>    <span class="n">BMv2</span> <span class="n">Drivers</span>
</pre></div>
</div>
<p>This is definitely more apps than what defined in <code class="docutils literal notranslate"><span class="pre">$ONOS_APPS</span></code>. That’s
because each app in ONOS can define other apps as dependencies. When loading an
app, ONOS automatically resolves dependencies and loads all other required apps.</p>
<p><strong>Disable link discovery service</strong></p>
<p>Link discovery will be the focus of the next exercise. For now, this service
lacks support in the P4 program. We suggest you deactivate it for the rest of
this exercise, to avoid running into issues. To deactivate the link discovery
service, using the following ONOS CLI command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">app</span> <span class="n">deactivate</span> <span class="n">lldpprovider</span>
</pre></div>
</div>
<p>To quit out of the ONOS CLI, use <code class="docutils literal notranslate"><span class="pre">Ctrl-D</span></code>. This will just end the CLI process
and will not stop the ONOS process.</p>
<p><strong>Restart ONOS in case of errors</strong></p>
<p>If anything goes wrong and you need to kill ONOS, you can use command <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">restart</span></code> to restart both Mininet and ONOS.</p>
</div>
<div class="section" id="build-app-and-register-pipeconf">
<h2>2. Build app and register pipeconf<a class="headerlink" href="#build-app-and-register-pipeconf" title="Permalink to this headline">¶</a></h2>
<p>Inside the <a class="reference external" href="./app">app/</a> directory you will find a starter implementation of an
ONOS app that includes a pipeconf. The pipeconf-related files are the following:</p>
<ul class="simple">
<li><a class="reference external" href="app/src/main/java/org/onosproject/ngsdn/tutorial/pipeconf/PipeconfLoader.java">PipeconfLoader.java</a>: A component that registers the
pipeconf at app activation;</li>
<li><a class="reference external" href="app/src/main/java/org/onosproject/ngsdn/tutorial/pipeconf/InterpreterImpl.java">InterpreterImpl.java</a>: An implementation of the
<code class="docutils literal notranslate"><span class="pre">PipelineInterpreter</span></code> driver behavior;</li>
<li><a class="reference external" href="app/src/main/java/org/onosproject/ngsdn/tutorial/pipeconf/PipelinerImpl.java">PipelinerImpl.java</a>: An implementation of the <code class="docutils literal notranslate"><span class="pre">Pipeliner</span></code>
driver behavior;</li>
</ul>
<p>To build the ONOS app (including the pipeconf), in the second terminal window,
use the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make app-build
</pre></div>
</div>
<p>This will produce a binary file <code class="docutils literal notranslate"><span class="pre">app/target/ngsdn-tutorial-1.0-SNAPSHOT.oar</span></code>
that we will use to install the application in the running ONOS instance.</p>
<p>Use the following command to upload to ONOS and activate the app binary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make app-reload
</pre></div>
</div>
<p>After the app has been activated, you should see the following messages in the
ONOS log (<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">onos-log</span></code>) signaling that the pipeconf has been registered and
the different app components have been started:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span>  <span class="p">[</span><span class="n">PiPipeconfManager</span><span class="p">]</span> <span class="n">New</span> <span class="n">pipeconf</span> <span class="n">registered</span><span class="p">:</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">ngsdn</span><span class="o">-</span><span class="n">tutorial</span> <span class="p">(</span><span class="n">fingerprint</span><span class="o">=...</span><span class="p">)</span>
<span class="n">INFO</span>  <span class="p">[</span><span class="n">MainComponent</span><span class="p">]</span> <span class="n">Started</span>
</pre></div>
</div>
<p>Alternatively, you can show the list of registered pipeconfs using the ONOS CLI
(<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">onos-cli</span></code>) command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">pipeconfs</span>
</pre></div>
</div>
</div>
<div class="section" id="push-netcfg-to-onos">
<h2>3. Push netcfg to ONOS<a class="headerlink" href="#push-netcfg-to-onos" title="Permalink to this headline">¶</a></h2>
<p>Now that ONOS and Mininet are running, it’s time to let ONOS know how to reach
the 4 switches and control them. We do this by using a configuration file
located at <a class="reference external" href="mininet/netcfg.json">mininet/netcfg.json</a>, which contains
information such as:</p>
<ul class="simple">
<li>The gRPC address and port associated to each Stratum device;</li>
<li>The ONOS driver to use for each device, <code class="docutils literal notranslate"><span class="pre">stratum-bmv2</span></code> in this case;</li>
<li>The pipeconf to use for each device, <code class="docutils literal notranslate"><span class="pre">org.onosproject.ngsdn-tutorial</span></code> in this
case, as defined in <a class="reference external" href="app/src/main/java/org/onosproject/ngsdn/tutorial/pipeconf/PipeconfLoader.java">PipeconfLoader.java</a>;</li>
<li>Configuration specific to our custom app (<code class="docutils literal notranslate"><span class="pre">fabricDeviceConfig</span></code>)</li>
</ul>
<p>This file contains also information related to the IPv6 configuration associated
to each switch interface. We will discuss this information in more details in
the next exercises.</p>
<p>On a terminal window, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make netcfg
</pre></div>
</div>
<p>This command will push the <code class="docutils literal notranslate"><span class="pre">netcfg.json</span></code> to ONOS, triggering discovery and
configuration of the 4 switches.</p>
<p>Check the ONOS log (<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">onos-log</span></code>), you should see messages like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>INFO  [GrpcChannelControllerImpl] Creating new gRPC channel grpc:///mininet:50001?device_id=1...
...
INFO  [StreamClientImpl] Setting mastership on device:leaf1...
...
INFO  [PipelineConfigClientImpl] Setting pipeline config for device:leaf1 to org.onosproject.ngsdn-tutorial...
...
INFO  [GnmiDeviceStateSubscriber] Started gNMI subscription for 6 ports on device:leaf1
...
INFO  [DeviceManager] Device device:leaf1 port [leaf1-eth1](1) status changed (enabled=true)
INFO  [DeviceManager] Device device:leaf1 port [leaf1-eth2](2) status changed (enabled=true)
INFO  [DeviceManager] Device device:leaf1 port [leaf1-eth3](3) status changed (enabled=true)
INFO  [DeviceManager] Device device:leaf1 port [leaf1-eth4](4) status changed (enabled=true)
INFO  [DeviceManager] Device device:leaf1 port [leaf1-eth5](5) status changed (enabled=true)
INFO  [DeviceManager] Device device:leaf1 port [leaf1-eth6](6) status changed (enabled=true)
</pre></div>
</div>
</div>
<div class="section" id="use-the-onos-cli-to-verify-the-network-configuration">
<h2>4. Use the ONOS CLI to verify the network configuration<a class="headerlink" href="#use-the-onos-cli-to-verify-the-network-configuration" title="Permalink to this headline">¶</a></h2>
<p>Access the ONOS CLI using <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">onos-cli</span></code>. Enter the following command to
verify the network config pushed before:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">netcfg</span>
</pre></div>
</div>
<div class="section" id="devices">
<h3>Devices<a class="headerlink" href="#devices" title="Permalink to this headline">¶</a></h3>
<p>Verify that all 4 devices have been discovered and are connected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">devices</span> <span class="o">-</span><span class="n">s</span>
<span class="nb">id</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">leaf1</span><span class="p">,</span> <span class="n">available</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">MASTER</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SWITCH</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">stratum</span><span class="o">-</span><span class="n">bmv2</span><span class="p">:</span><span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">ngsdn</span><span class="o">-</span><span class="n">tutorial</span>
<span class="nb">id</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">leaf2</span><span class="p">,</span> <span class="n">available</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">MASTER</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SWITCH</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">stratum</span><span class="o">-</span><span class="n">bmv2</span><span class="p">:</span><span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">ngsdn</span><span class="o">-</span><span class="n">tutorial</span>
<span class="nb">id</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">spine1</span><span class="p">,</span> <span class="n">available</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">MASTER</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SWITCH</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">stratum</span><span class="o">-</span><span class="n">bmv2</span><span class="p">:</span><span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">ngsdn</span><span class="o">-</span><span class="n">tutorial</span>
<span class="nb">id</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">spine2</span><span class="p">,</span> <span class="n">available</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">MASTER</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SWITCH</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">stratum</span><span class="o">-</span><span class="n">bmv2</span><span class="p">:</span><span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">ngsdn</span><span class="o">-</span><span class="n">tutorial</span>
</pre></div>
</div>
<p>Make sure you see <code class="docutils literal notranslate"><span class="pre">available=true</span></code> for all devices. That means ONOS has a gRPC
channel open to the device and the pipeline configuration has been pushed.</p>
</div>
<div class="section" id="ports">
<h3>Ports<a class="headerlink" href="#ports" title="Permalink to this headline">¶</a></h3>
<p>Check port information, obtained by ONOS by performing a gNMI Get RPC for the
OpenConfig Interfaces model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">ports</span> <span class="o">-</span><span class="n">s</span> <span class="n">device</span><span class="p">:</span><span class="n">spine1</span>
<span class="nb">id</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">spine1</span><span class="p">,</span> <span class="n">available</span><span class="o">=</span><span class="n">true</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="n">MASTER</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">SWITCH</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">stratum</span><span class="o">-</span><span class="n">bmv2</span><span class="p">:</span><span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">ngsdn</span><span class="o">-</span><span class="n">tutorial</span>
  <span class="n">port</span><span class="o">=</span><span class="p">[</span><span class="n">spine1</span><span class="o">-</span><span class="n">eth1</span><span class="p">](</span><span class="mi">1</span><span class="p">),</span> <span class="n">state</span><span class="o">=</span><span class="n">enabled</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">copper</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mi">10000</span> <span class="p">,</span> <span class="o">...</span>
  <span class="n">port</span><span class="o">=</span><span class="p">[</span><span class="n">spine1</span><span class="o">-</span><span class="n">eth2</span><span class="p">](</span><span class="mi">2</span><span class="p">),</span> <span class="n">state</span><span class="o">=</span><span class="n">enabled</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">copper</span><span class="p">,</span> <span class="n">speed</span><span class="o">=</span><span class="mi">10000</span> <span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p>Check port statistics, also obtained by querying the OpenConfig Interfaces model
via gNMI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">portstats</span> <span class="n">device</span><span class="p">:</span><span class="n">spine1</span>
<span class="n">deviceId</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">spine1</span>
   <span class="n">port</span><span class="o">=</span><span class="p">[</span><span class="n">spine1</span><span class="o">-</span><span class="n">eth1</span><span class="p">](</span><span class="mi">1</span><span class="p">),</span> <span class="n">pktRx</span><span class="o">=</span><span class="mi">114</span><span class="p">,</span> <span class="n">pktTx</span><span class="o">=</span><span class="mi">114</span><span class="p">,</span> <span class="n">bytesRx</span><span class="o">=</span><span class="mi">14022</span><span class="p">,</span> <span class="n">bytesTx</span><span class="o">=</span><span class="mi">14136</span><span class="p">,</span> <span class="n">pktRxDrp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pktTxDrp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Dur</span><span class="o">=</span><span class="mi">173</span>
   <span class="n">port</span><span class="o">=</span><span class="p">[</span><span class="n">spine1</span><span class="o">-</span><span class="n">eth2</span><span class="p">](</span><span class="mi">2</span><span class="p">),</span> <span class="n">pktRx</span><span class="o">=</span><span class="mi">114</span><span class="p">,</span> <span class="n">pktTx</span><span class="o">=</span><span class="mi">114</span><span class="p">,</span> <span class="n">bytesRx</span><span class="o">=</span><span class="mi">14022</span><span class="p">,</span> <span class="n">bytesTx</span><span class="o">=</span><span class="mi">14136</span><span class="p">,</span> <span class="n">pktRxDrp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pktTxDrp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Dur</span><span class="o">=</span><span class="mi">173</span>
</pre></div>
</div>
</div>
<div class="section" id="flow-rules-and-groups">
<h3>Flow rules and groups<a class="headerlink" href="#flow-rules-and-groups" title="Permalink to this headline">¶</a></h3>
<p>Check the ONOS flow rules, you should see 3 flow rules for each device. For
example, to show all flow rules installed so far on device <code class="docutils literal notranslate"><span class="pre">leaf1</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">flows</span> <span class="o">-</span><span class="n">s</span> <span class="nb">any</span> <span class="n">device</span><span class="p">:</span><span class="n">leaf1</span>
<span class="n">deviceId</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">leaf1</span><span class="p">,</span> <span class="n">flowRuleCount</span><span class="o">=</span><span class="mi">3</span>
    <span class="n">ADDED</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">IngressPipeImpl</span><span class="o">.</span><span class="n">acl_table</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="p">[</span><span class="n">ETH_TYPE</span><span class="p">:</span><span class="n">arp</span><span class="p">],</span> <span class="n">treatment</span><span class="o">=</span><span class="p">[</span><span class="n">immediate</span><span class="o">=</span><span class="p">[</span><span class="n">IngressPipeImpl</span><span class="o">.</span><span class="n">clone_to_cpu</span><span class="p">()]]</span>
    <span class="n">ADDED</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">IngressPipeImpl</span><span class="o">.</span><span class="n">acl_table</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="p">[</span><span class="n">ETH_TYPE</span><span class="p">:</span><span class="n">ipv6</span><span class="p">,</span> <span class="n">IP_PROTO</span><span class="p">:</span><span class="mi">58</span><span class="p">,</span> <span class="n">ICMPV6_TYPE</span><span class="p">:</span><span class="mi">136</span><span class="p">],</span> <span class="n">treatment</span><span class="o">=</span><span class="p">[</span><span class="n">immediate</span><span class="o">=</span><span class="p">[</span><span class="n">IngressPipeImpl</span><span class="o">.</span><span class="n">clone_to_cpu</span><span class="p">()]]</span>
    <span class="n">ADDED</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="n">IngressPipeImpl</span><span class="o">.</span><span class="n">acl_table</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">40000</span><span class="p">,</span> <span class="n">selector</span><span class="o">=</span><span class="p">[</span><span class="n">ETH_TYPE</span><span class="p">:</span><span class="n">ipv6</span><span class="p">,</span> <span class="n">IP_PROTO</span><span class="p">:</span><span class="mi">58</span><span class="p">,</span> <span class="n">ICMPV6_TYPE</span><span class="p">:</span><span class="mi">135</span><span class="p">],</span> <span class="n">treatment</span><span class="o">=</span><span class="p">[</span><span class="n">immediate</span><span class="o">=</span><span class="p">[</span><span class="n">IngressPipeImpl</span><span class="o">.</span><span class="n">clone_to_cpu</span><span class="p">()]]</span>
</pre></div>
</div>
<p>This list include flow rules installed by the ONOS built-in services such as
<code class="docutils literal notranslate"><span class="pre">hostprovider</span></code>. We’ll talk more about these services in the next exercise.</p>
<p>To show all groups installed so far, you can use the <code class="docutils literal notranslate"><span class="pre">groups</span></code> command. For
example to show groups on <code class="docutils literal notranslate"><span class="pre">leaf1</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">groups</span> <span class="nb">any</span> <span class="n">device</span><span class="p">:</span><span class="n">leaf1</span>
<span class="n">deviceId</span><span class="o">=</span><span class="n">device</span><span class="p">:</span><span class="n">leaf1</span><span class="p">,</span> <span class="n">groupCount</span><span class="o">=</span><span class="mi">1</span>
   <span class="nb">id</span><span class="o">=</span><span class="mh">0x63</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="n">ADDED</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">CLONE</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">appId</span><span class="o">=</span><span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">core</span><span class="p">,</span> <span class="n">referenceCount</span><span class="o">=</span><span class="mi">0</span>
       <span class="nb">id</span><span class="o">=</span><span class="mh">0x63</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">packets</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weight</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="n">OUTPUT</span><span class="p">:</span><span class="n">CONTROLLER</span><span class="p">]</span>
</pre></div>
</div>
<p>“Group” is an ONOS northbound abstraction that is mapped internally to different
types of P4Runtime entities. In this case, you should see 1 group of type
<code class="docutils literal notranslate"><span class="pre">CLONE</span></code>, internally mapped to a P4Runtime <code class="docutils literal notranslate"><span class="pre">CloneSessionEntry</span></code>, here used to
clone packets to the controller via packet-in. We’ll talk more about controller
packet-in/out in the next session.</p>
</div>
</div>
<div class="section" id="visualize-the-topology-on-the-onos-web-ui">
<h2>5. Visualize the topology on the ONOS web UI<a class="headerlink" href="#visualize-the-topology-on-the-onos-web-ui" title="Permalink to this headline">¶</a></h2>
<p>Using the ONF Cloud Tutorial Portal, access the ONOS UI.
If you are using the tutorial VM, open up a browser (e.g. Firefox) to
<a class="reference external" href="http://127.0.0.1:8181/onos/ui">http://127.0.0.1:8181/onos/ui</a>.</p>
<p>When asked, use the username <code class="docutils literal notranslate"><span class="pre">onos</span></code> and password <code class="docutils literal notranslate"><span class="pre">rocks</span></code>.</p>
<p>You should see 4 devices in the topology view, corresponding to the 4 switches
of our 2x2 fabric. Press <code class="docutils literal notranslate"><span class="pre">L</span></code> to show device labels. Because link discovery is
not enabled, the ONOS UI will not show any links between the devices.</p>
<p>While here, feel free to interact with and discover the ONOS UI. For more
information on how to use the ONOS web UI please refer to this guide:</p>
<p><a class="reference external" href="https://wiki.onosproject.org/x/OYMg">https://wiki.onosproject.org/x/OYMg</a></p>
<p>There is a way to show the pipeconf details for a given device, can you find it?</p>
<div class="section" id="pipeconf-ui">
<h3>Pipeconf UI<a class="headerlink" href="#pipeconf-ui" title="Permalink to this headline">¶</a></h3>
<p>In the ONOS topology view click on one of the switches (e.g <code class="docutils literal notranslate"><span class="pre">device:leaf1</span></code>)
and the Device Details panel appears. In that panel click on the Pipeconf icon
(the last one), to open the Pipeconf view for that device.</p>
<p><img alt="device-leaf1-details-panel" src="exercises/img/device-leaf1-details-panel.png" /></p>
<p>Here you will find info on the pipeconf currently used by the specific device,
including details of the P4 tables.</p>
<p><img alt="onos-gui-pipeconf-leaf1" src="exercises/img/onos-gui-pipeconf-leaf1.png" /></p>
<p>Clicking the table row brings up the details panel, showing details of the match
fields, actions, action parameter bit widths, etc.</p>
</div>
</div>
<div class="section" id="congratulations">
<h2>Congratulations!<a class="headerlink" href="#congratulations" title="Permalink to this headline">¶</a></h2>
<p>You have completed the third exercise! If there is still time before the end of
this session, you can check the bonus steps below.</p>
<div class="section" id="bonus-inspect-stratum-bmv2-internal-state">
<h3>Bonus: inspect stratum_bmv2 internal state<a class="headerlink" href="#bonus-inspect-stratum-bmv2-internal-state" title="Permalink to this headline">¶</a></h3>
<p>You can use the P4Runtime shell to dump all table entries currently
installed on the switch by ONOS. On a separate terminal window type, start a
P4Runtime shell for leaf1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ util/p4rt-sh --grpc-addr localhost:50001 --election-id 0,1
</pre></div>
</div>
<p>On the shell prompt, type the following command to dump all entries from the ACL
table:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P4Runtime</span> <span class="n">sh</span> <span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">te</span> <span class="ow">in</span> <span class="n">table_entry</span><span class="p">[</span><span class="s2">&quot;IngressPipeImpl.acl_table&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">():</span>
            <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">te</span><span class="p">)</span>
            <span class="o">...</span><span class="p">:</span>
</pre></div>
</div>
<p>You should see exactly 3 entries, each one corresponding to a flow rule
in ONOS. For example, the flow rule matching on NDP NS packets should look
like this in the P4runtime shell:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">table_id</span><span class="p">:</span> <span class="mi">33557865</span> <span class="p">(</span><span class="s2">&quot;IngressPipeImpl.acl_table&quot;</span><span class="p">)</span>
<span class="n">match</span> <span class="p">{</span>
  <span class="n">field_id</span><span class="p">:</span> <span class="mi">4</span> <span class="p">(</span><span class="s2">&quot;hdr.ethernet.ether_type&quot;</span><span class="p">)</span>
  <span class="n">ternary</span> <span class="p">{</span>
    <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x86</span><span class="se">\\</span><span class="s2">xdd&quot;</span>
    <span class="n">mask</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">xff</span><span class="se">\\</span><span class="s2">xff&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">match</span> <span class="p">{</span>
  <span class="n">field_id</span><span class="p">:</span> <span class="mi">5</span> <span class="p">(</span><span class="s2">&quot;hdr.ipv6.next_hdr&quot;</span><span class="p">)</span>
  <span class="n">ternary</span> <span class="p">{</span>
    <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x3a&quot;</span>
    <span class="n">mask</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">xff&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">match</span> <span class="p">{</span>
  <span class="n">field_id</span><span class="p">:</span> <span class="mi">6</span> <span class="p">(</span><span class="s2">&quot;hdr.icmpv6.type&quot;</span><span class="p">)</span>
  <span class="n">ternary</span> <span class="p">{</span>
    <span class="n">value</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">x87&quot;</span>
    <span class="n">mask</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">xff&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">action</span> <span class="p">{</span>
  <span class="n">action</span> <span class="p">{</span>
    <span class="n">action_id</span><span class="p">:</span> <span class="mi">16782152</span> <span class="p">(</span><span class="s2">&quot;IngressPipeImpl.clone_to_cpu&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">priority</span><span class="p">:</span> <span class="mi">40001</span>
</pre></div>
</div>
</div>
<div class="section" id="bonus-show-onos-grpc-log">
<h3>Bonus: show ONOS gRPC log<a class="headerlink" href="#bonus-show-onos-grpc-log" title="Permalink to this headline">¶</a></h3>
<p>ONOS provides a debugging feature that allow dumping to file all gRPC messages
exchanged with a device. To enable this feature, type the following command in
the ONOS CLI (<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">onos-cli</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">cfg</span> <span class="nb">set</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">grpc</span><span class="o">.</span><span class="n">ctl</span><span class="o">.</span><span class="n">GrpcChannelControllerImpl</span> <span class="n">enableMessageLog</span> <span class="n">true</span>
</pre></div>
</div>
<p>Check the content of directory <code class="docutils literal notranslate"><span class="pre">tmp/onos</span></code> in the <code class="docutils literal notranslate"><span class="pre">ngsdn-tutorial</span></code> root. You
should see many files, some of which starting with name <code class="docutils literal notranslate"><span class="pre">grpc___mininet_</span></code>. You
should see 4 of such files in total, one file per device, named after the gRPC
port used to establish the gRPC chanel.</p>
<p>Check content of one of these files, you should see a dump of the gRPC messages
in Protobuf Text format for messages like:</p>
<ul class="simple">
<li>P4Runtime <code class="docutils literal notranslate"><span class="pre">PacketIn</span></code> and <code class="docutils literal notranslate"><span class="pre">PacketOut</span></code>;</li>
<li>P4Runtime Read RPCs used to periodically dump table entries and read counters;</li>
<li>gNMI Get RPCs to read port counters.</li>
</ul>
<p>Remember to disable the gRPC message logging in ONOS when you’re done, to avoid
affecting performances:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">onos</span><span class="o">&gt;</span> <span class="n">cfg</span> <span class="nb">set</span> <span class="n">org</span><span class="o">.</span><span class="n">onosproject</span><span class="o">.</span><span class="n">grpc</span><span class="o">.</span><span class="n">ctl</span><span class="o">.</span><span class="n">GrpcChannelControllerImpl</span> <span class="n">enableMessageLog</span> <span class="n">false</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="EXERCISE-4.html" class="btn btn-neutral float-right" title="Exercise 4: Enabling ONOS built-in services" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="EXERCISE-2.html" class="btn btn-neutral float-left" title="Exercise 2: Yang, OpenConfig, and gNMI basics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
